/*!
 * Copyright (c) 2021 Momo Bassit.
 * Licensed under the MIT License (MIT)
 * https://github.com/mdbassit/Coloris
 */
((e,t,l,a)=>{const r=t.createElement("canvas").getContext("2d"),n={r:0,g:0,b:0,h:0,s:0,v:0,a:1};let o,c,s,i,u,p,d,h,f,b,y,m,g,v,w,k,L={};const E={el:"[data-coloris]",parent:"body",theme:"default",themeMode:"light",rtl:!1,wrap:!0,margin:2,format:"hex",formatToggle:!1,swatches:[],swatchesOnly:!1,alpha:!0,forceAlpha:!1,focusInput:!0,selectInput:!1,inline:!1,defaultColor:"#000000",clearButton:!1,clearLabel:"Clear",closeButton:!1,closeLabel:"Close",onChange:()=>a,a11y:{open:"Open color picker",close:"Close color picker",clear:"Clear the selected color",marker:"Saturation: {s}. Brightness: {v}.",hueSlider:"Hue slider",alphaSlider:"Opacity slider",input:"Color value field",format:"Color format",swatch:"Color swatch",instruction:"Saturation and brightness selector. Use up, down, left and right arrow keys to select."}},x={};let A="",$={},C=!1;function S(l){if("object"==typeof l)for(const r in l)switch(r){case"el":H(l.el),!1!==l.wrap&&D(l.el);break;case"parent":o=l.parent instanceof HTMLElement?l.parent:t.querySelector(l.parent),o&&(o.appendChild(c),E.parent=l.parent,o===t.body&&(o=a));break;case"themeMode":E.themeMode=l.themeMode,"auto"===l.themeMode&&e.matchMedia&&e.matchMedia("(prefers-color-scheme: dark)").matches&&(E.themeMode="dark");case"theme":l.theme&&(E.theme=l.theme),c.className=`clr-picker clr-${E.theme} clr-${E.themeMode}`,E.inline&&O();break;case"rtl":E.rtl=!!l.rtl,Array.from(t.getElementsByClassName("clr-field")).forEach((e=>e.classList.toggle("clr-rtl",E.rtl)));break;case"margin":l.margin*=1,E.margin=isNaN(l.margin)?E.margin:l.margin;break;case"wrap":l.el&&l.wrap&&D(l.el);break;case"formatToggle":E.formatToggle=!!l.formatToggle,Q("clr-format").style.display=E.formatToggle?"block":"none",E.formatToggle&&(E.format="auto");break;case"swatches":if(Array.isArray(l.swatches)){const e=Q("clr-swatches"),a=t.createElement("div");e.textContent="",l.swatches.forEach(((e,l)=>{const r=t.createElement("button");r.setAttribute("type","button"),r.setAttribute("id",`clr-swatch-${l}`),r.setAttribute("aria-labelledby",`clr-swatch-label clr-swatch-${l}`),r.style.color=e,r.textContent=e,a.appendChild(r)})),l.swatches.length&&e.appendChild(a),E.swatches=l.swatches.slice()}break;case"swatchesOnly":E.swatchesOnly=!!l.swatchesOnly,c.setAttribute("data-minimal",E.swatchesOnly);break;case"alpha":E.alpha=!!l.alpha,c.setAttribute("data-alpha",E.alpha);break;case"inline":if(E.inline=!!l.inline,c.setAttribute("data-inline",E.inline),E.inline){const e=l.defaultColor||E.defaultColor;v=Y(e),O(),W(e)}break;case"clearButton":"object"==typeof l.clearButton&&(l.clearButton.label&&(E.clearLabel=l.clearButton.label,d.innerHTML=E.clearLabel),l.clearButton=l.clearButton.show),E.clearButton=!!l.clearButton,d.style.display=E.clearButton?"block":"none";break;case"clearLabel":E.clearLabel=l.clearLabel,d.innerHTML=E.clearLabel;break;case"closeButton":E.closeButton=!!l.closeButton,E.closeButton?c.insertBefore(h,u):u.appendChild(h);break;case"closeLabel":E.closeLabel=l.closeLabel,h.innerHTML=E.closeLabel;break;case"a11y":const n=l.a11y;let i=!1;if("object"==typeof n)for(const e in n)n[e]&&E.a11y[e]&&(E.a11y[e]=n[e],i=!0);if(i){const e=Q("clr-open-label"),t=Q("clr-swatch-label");e.innerHTML=E.a11y.open,t.innerHTML=E.a11y.swatch,h.setAttribute("aria-label",E.a11y.close),d.setAttribute("aria-label",E.a11y.clear),f.setAttribute("aria-label",E.a11y.hueSlider),y.setAttribute("aria-label",E.a11y.alphaSlider),p.setAttribute("aria-label",E.a11y.input),s.setAttribute("aria-label",E.a11y.instruction)}break;default:E[r]=l[r]}}function T(e,t){"string"==typeof e&&"object"==typeof t&&(x[e]=t,C=!0)}function B(e){delete x[e],0===Object.keys(x).length&&(C=!1,e===A&&M())}function M(){Object.keys($).length>0&&(S($),A="",$={})}function H(e){e instanceof HTMLElement&&(e=[e]),Array.isArray(e)?e.forEach((e=>{V(e,"click",N),V(e,"input",j)})):(V(t,"click",e,N),V(t,"input",e,j))}function N(e){E.inline||(!function(e){if(C){const t=["el","wrap","rtl","inline","defaultColor","a11y"];for(let l in x){const a=x[l];if(e.matches(l)){A=l,$={},t.forEach((e=>delete a[e]));for(let e in a)$[e]=Array.isArray(E[e])?E[e].slice():E[e];S(a);break}}}}(e.target),g=e.target,w=g.value,v=Y(w),c.classList.add("clr-open"),O(),W(w),(E.focusInput||E.selectInput)&&(p.focus({preventScroll:!0}),p.setSelectionRange(g.selectionStart,g.selectionEnd)),E.selectInput&&p.select(),(k||E.swatchesOnly)&&J().shift().focus(),g.dispatchEvent(new Event("open",{bubbles:!0})))}function O(){const l=o,a=e.scrollY,r=c.offsetWidth,n=c.offsetHeight,i={left:!1,top:!1};let u,p,d,h={x:0,y:0};if(l&&(u=e.getComputedStyle(l),p=parseFloat(u.marginTop),d=parseFloat(u.borderTopWidth),h=l.getBoundingClientRect(),h.y+=d+a),!E.inline){const e=g.getBoundingClientRect();let o=e.x,s=a+e.y+e.height+E.margin;l?(o-=h.x,s-=h.y,o+r>l.clientWidth&&(o+=e.width-r,i.left=!0),s+n>l.clientHeight-p&&n+E.margin<=e.top-(h.y-a)&&(s-=e.height+n+2*E.margin,i.top=!0),s+=l.scrollTop):(o+r>t.documentElement.clientWidth&&(o+=e.width-r,i.left=!0),s+n-a>t.documentElement.clientHeight&&n+E.margin<=e.top&&(s=a+e.y-n-E.margin,i.top=!0)),c.classList.toggle("clr-left",i.left),c.classList.toggle("clr-top",i.top),c.style.left=`${o}px`,c.style.top=`${s}px`,h.x+=c.offsetLeft,h.y+=c.offsetTop}L={width:s.offsetWidth,height:s.offsetHeight,x:s.offsetLeft+h.x,y:s.offsetTop+h.y}}function D(e){e instanceof HTMLElement?I(e):Array.isArray(e)?e.forEach(I):t.querySelectorAll(e).forEach(I)}function I(e){const l=e.parentNode;if(!l.classList.contains("clr-field")){const a=t.createElement("div");let r="clr-field";(E.rtl||e.classList.contains("clr-rtl"))&&(r+=" clr-rtl"),a.innerHTML='<button type="button" aria-labelledby="clr-open-label"></button>',l.insertBefore(a,e),a.className=r,a.style.color=e.value,a.appendChild(e)}}function j(e){const t=e.target.parentNode;t.classList.contains("clr-field")&&(t.style.color=e.target.value)}function R(e){if(g&&!E.inline){const t=g;e&&(g=a,w!==t.value&&(t.value=w,t.dispatchEvent(new Event("input",{bubbles:!0})))),setTimeout((()=>{w!==t.value&&t.dispatchEvent(new Event("change",{bubbles:!0}))})),c.classList.remove("clr-open"),C&&M(),t.dispatchEvent(new Event("close",{bubbles:!0})),E.focusInput&&t.focus({preventScroll:!0}),g=a}}function W(e){const t=function(e){const t=/^((rgba)|rgb)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i;let l,a;r.fillStyle="#000",r.fillStyle=e,l=t.exec(r.fillStyle),l?a={r:1*l[3],g:1*l[4],b:1*l[5],a:1*l[6]}:(l=r.fillStyle.replace("#","").match(/.{2}/g).map((e=>parseInt(e,16))),a={r:l[0],g:l[1],b:l[2],a:1});return a}(e),a=function(e){const t=e.r/255,a=e.g/255,r=e.b/255,n=l.max(t,a,r),o=l.min(t,a,r),c=n-o,s=n;let i=0,u=0;c&&(n===t&&(i=(a-r)/c),n===a&&(i=2+(r-t)/c),n===r&&(i=4+(t-a)/c),n&&(u=c/n));return i=l.floor(60*i),{h:i<0?i+360:i,s:l.round(100*u),v:l.round(100*s),a:e.a}}(t);U(a.s,a.v),G(t,a),f.value=a.h,c.style.color=`hsl(${a.h}, 100%, 50%)`,b.style.left=a.h/360*100+"%",i.style.left=L.width*a.s/100+"px",i.style.top=L.height-L.height*a.v/100+"px",y.value=100*a.a,m.style.left=100*a.a+"%"}function Y(e){const t=e.substring(0,3).toLowerCase();return"rgb"===t||"hsl"===t?t:"hex"}function q(l){l=l!==a?l:p.value,g&&(g.value=l,g.dispatchEvent(new Event("input",{bubbles:!0}))),E.onChange&&E.onChange.call(e,l,g),t.dispatchEvent(new CustomEvent("coloris:pick",{detail:{color:l,currentEl:g}}))}function F(e,t){const a={h:1*f.value,s:e/L.width*100,v:100-t/L.height*100,a:y.value/100},r=function(e){const t=e.s/100,a=e.v/100;let r=t*a,n=e.h/60,o=r*(1-l.abs(n%2-1)),c=a-r;r+=c,o+=c;const s=l.floor(n)%6,i=[r,o,c,c,o,r][s],u=[o,r,r,o,c,c][s],p=[c,c,o,r,r,o][s];return{r:l.round(255*i),g:l.round(255*u),b:l.round(255*p),a:e.a}}(a);U(a.s,a.v),G(r,a),q()}function U(e,t){let l=E.a11y.marker;e=1*e.toFixed(1),t=1*t.toFixed(1),l=l.replace("{s}",e),l=l.replace("{v}",t),i.setAttribute("aria-label",l)}function X(e){const t=function(e){return{pageX:e.changedTouches?e.changedTouches[0].pageX:e.pageX,pageY:e.changedTouches?e.changedTouches[0].pageY:e.pageY}}(e);let l=t.pageX-L.x,a=t.pageY-L.y;o&&(a+=o.scrollTop),P(l,a),e.preventDefault(),e.stopPropagation()}function P(e,t){e=e<0?0:e>L.width?L.width:e,t=t<0?0:t>L.height?L.height:t,i.style.left=`${e}px`,i.style.top=`${t}px`,F(e,t),i.focus()}function G(e={},a={}){let r=E.format;for(const t in e)n[t]=e[t];for(const e in a)n[e]=a[e];const o=function(e){let t=e.r.toString(16),l=e.g.toString(16),a=e.b.toString(16),r="";e.r<16&&(t="0"+t);e.g<16&&(l="0"+l);e.b<16&&(a="0"+a);if(E.alpha&&(e.a<1||E.forceAlpha)){const t=255*e.a|0;r=t.toString(16),t<16&&(r="0"+r)}return"#"+t+l+a+r}(n),c=o.substring(0,7);switch(i.style.color=c,m.parentNode.style.color=c,m.style.color=o,u.style.color=o,s.style.display="none",s.offsetHeight,s.style.display="",m.nextElementSibling.style.display="none",m.nextElementSibling.offsetHeight,m.nextElementSibling.style.display="","mixed"===r?r=1===n.a?"hex":"rgb":"auto"===r&&(r=v),r){case"hex":p.value=o;break;case"rgb":p.value=function(e){return!E.alpha||1===e.a&&!E.forceAlpha?`rgb(${e.r}, ${e.g}, ${e.b})`:`rgba(${e.r}, ${e.g}, ${e.b}, ${e.a})`}(n);break;case"hsl":p.value=(d=function(e){const t=e.v/100,a=t*(1-e.s/100/2);let r;return a>0&&a<1&&(r=l.round((t-a)/l.min(a,1-a)*100)),{h:e.h,s:r||0,l:l.round(100*a),a:e.a}}(n),!E.alpha||1===d.a&&!E.forceAlpha?`hsl(${d.h}, ${d.s}%, ${d.l}%)`:`hsla(${d.h}, ${d.s}%, ${d.l}%, ${d.a})`)}var d;t.querySelector(`.clr-format [value="${r}"]`).checked=!0}function K(){const e=1*f.value,t=1*i.style.left.replace("px",""),l=1*i.style.top.replace("px","");c.style.color=`hsl(${e}, 100%, 50%)`,b.style.left=e/360*100+"%",F(t,l)}function z(){const e=y.value/100;m.style.left=100*e+"%",G({a:e}),q()}function J(){return Array.from(c.querySelectorAll("input, button")).filter((e=>!!e.offsetWidth))}function Q(e){return t.getElementById(e)}function V(e,t,l,a){const r=Element.prototype.matches||Element.prototype.msMatchesSelector;"string"==typeof l?e.addEventListener(t,(e=>{r.call(e.target,l)&&a.call(e.target,e)})):(a=l,e.addEventListener(t,a))}function Z(e,l){l=l!==a?l:[],"loading"!==t.readyState?e(...l):t.addEventListener("DOMContentLoaded",(()=>{e(...l)}))}NodeList!==a&&NodeList.prototype&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),e.Coloris=(()=>{const e={set:S,wrap:D,close:R,setInstance:T,removeInstance:B,updatePosition:O,ready:Z};function t(e){Z((()=>{e&&("string"==typeof e?H(e):S(e))}))}for(const l in e)t[l]=(...t)=>{Z(e[l],t)};return t})(),Z((function(){o=a,c=t.createElement("div"),c.setAttribute("id","clr-picker"),c.className="clr-picker",c.innerHTML=`<input id="clr-color-value" name="clr-color-value" class="clr-color" type="text" value="" spellcheck="false" aria-label="${E.a11y.input}"><div id="clr-color-area" class="clr-gradient" role="application" aria-label="${E.a11y.instruction}"><div id="clr-color-marker" class="clr-marker" tabindex="0"></div></div><div class="clr-hue"><input id="clr-hue-slider" name="clr-hue-slider" type="range" min="0" max="360" step="1" aria-label="${E.a11y.hueSlider}"><div id="clr-hue-marker"></div></div><div class="clr-alpha"><input id="clr-alpha-slider" name="clr-alpha-slider" type="range" min="0" max="100" step="1" aria-label="${E.a11y.alphaSlider}"><div id="clr-alpha-marker"></div><span></span></div><div id="clr-format" class="clr-format"><fieldset class="clr-segmented"><legend>${E.a11y.format}</legend><input id="clr-f1" type="radio" name="clr-format" value="hex"><label for="clr-f1">Hex</label><input id="clr-f2" type="radio" name="clr-format" value="rgb"><label for="clr-f2">RGB</label><input id="clr-f3" type="radio" name="clr-format" value="hsl"><label for="clr-f3">HSL</label><span></span></fieldset></div><div id="clr-swatches" class="clr-swatches"></div><button type="button" id="clr-clear" class="clr-clear" aria-label="${E.a11y.clear}">${E.clearLabel}</button><div id="clr-color-preview" class="clr-preview"><button type="button" id="clr-close" class="clr-close" aria-label="${E.a11y.close}">${E.closeLabel}</button></div><span id="clr-open-label" hidden>${E.a11y.open}</span><span id="clr-swatch-label" hidden>${E.a11y.swatch}</span>`,t.body.appendChild(c),s=Q("clr-color-area"),i=Q("clr-color-marker"),d=Q("clr-clear"),h=Q("clr-close"),u=Q("clr-color-preview"),p=Q("clr-color-value"),f=Q("clr-hue-slider"),b=Q("clr-hue-marker"),y=Q("clr-alpha-slider"),m=Q("clr-alpha-marker"),H(E.el),D(E.el),V(c,"mousedown",(e=>{c.classList.remove("clr-keyboard-nav"),e.stopPropagation()})),V(s,"mousedown",(e=>{V(t,"mousemove",X)})),V(s,"contextmenu",(e=>{e.preventDefault()})),V(s,"touchstart",(e=>{t.addEventListener("touchmove",X,{passive:!1})})),V(i,"mousedown",(e=>{V(t,"mousemove",X)})),V(i,"touchstart",(e=>{t.addEventListener("touchmove",X,{passive:!1})})),V(p,"change",(e=>{const t=p.value;if(g||E.inline){q(""===t?t:W(t))}})),V(d,"click",(e=>{q(""),R()})),V(h,"click",(e=>{q(),R()})),V(Q("clr-format"),"click",".clr-format input",(e=>{v=e.target.value,G(),q()})),V(c,"click",".clr-swatches button",(e=>{W(e.target.textContent),q(),E.swatchesOnly&&R()})),V(t,"mouseup",(e=>{t.removeEventListener("mousemove",X)})),V(t,"touchend",(e=>{t.removeEventListener("touchmove",X)})),V(t,"mousedown",(e=>{k=!1,c.classList.remove("clr-keyboard-nav"),R()})),V(t,"keydown",(e=>{const t=e.key,l=e.target,a=e.shiftKey;if("Escape"!==t)if("Enter"!==t||"BUTTON"===l.tagName){if(["Tab","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t)&&(k=!0,c.classList.add("clr-keyboard-nav")),"Tab"===t&&l.matches(".clr-picker *")){const t=J(),r=t.shift(),n=t.pop();a&&l===r?(n.focus(),e.preventDefault()):a||l!==n||(r.focus(),e.preventDefault())}}else R();else R(!0)})),V(t,"click",".clr-field button",(e=>{C&&M(),e.target.nextElementSibling.dispatchEvent(new Event("click",{bubbles:!0}))})),V(i,"keydown",(e=>{const t={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};Object.keys(t).includes(e.key)&&(!function(e,t){P(1*i.style.left.replace("px","")+e,1*i.style.top.replace("px","")+t)}(...t[e.key]),e.preventDefault())})),V(s,"click",X),V(f,"input",K),V(y,"input",z)}))})(window,document,Math);
